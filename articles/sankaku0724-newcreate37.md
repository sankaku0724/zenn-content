---
title: "【初学者向け】IPv4とIPv6の違いをまとめてみた"
emoji: "🌍"
type: "tech"
topics:
  - "ipv6"
  - "ipv4"
  - "network"
  - "初心者"
  - "入門"
published: false
---

## はじめに

この記事は、「[小川晃通 著, プロフェッショナルIPv6 第2版, ラムダノート](https://www.lambdanote.com/products/ipv6-2)」の2.10節の内容を参考に、IPv4とIPv6の違いををまとめたものになります。

:::message
もし誤解や間違いがあれば、ぜひコメントなどでご指摘していただけると助かります。
:::

## IPv6の簡単なおさらい

IPv6（Internet Protocol version 6）は、**インターネットに接続するための次世代プロトコル**です。
従来のIPv4アドレス枯渇問題の解決策として設計されました。

## IPv4とIPv6の違い

ここからはIPv4とIPv6の違いについて説明します。

### IPアドレス長

**IPv4アドレスの長さが32ビット**だったのに対し、**IPv6アドレスの長さは128ビット**です。

IPv6アドレスは4倍の長さですが、表現できるIPアドレスの数にはもっと大きな差があります。

**1ビット増えるごとに2倍になる**ため、**IPv6のビット数で表現できるIPアドレスの数はIPv4アドレスの$2^{96}$倍**になります。

### IPアドレスのテキスト表記

IPv4アドレスでは**ドット(.)区切りの十進表記**です。
- 例: 192.168.1.1

しかし、IPv6アドレスでは**コロン(:)区切りの十六進表記**です。
- 例: 2001:0db8:85a3:0000:0000:8a2e:0370:7334

### IPアドレスの構成要素

IPv4アドレスは、**ネットワーク部とホスト部**によって構成されています。

これに対応するIPv6のユニキャストアドレスは、**サブネットプレフィックス**(ネットワークを識別する部分)と**インターフェース識別子**(ネットワーク内の特定のホストやインターフェースを識別する部分)によって構成されます。

これは単なる名称の違いではありません。
IPv6アドレスの割り当て対象がホストではなく、ネットワークインターフェースであることを意味しています。

### アドレスのフォーマットの利用方法

IPv6では、さまざまなプロトコルの機能を実現するために、**IPv6アドレスのフォーマット**が利用されています。
例えば、IPv6マルチキャストでは、スコープやマルチキャストアドレスの構成がアドレスのフォーマットから判別できるようになっています。

IPv4/IPv6共存技術として、IPv4アドレスを埋め込んだフォーマットのIPv6アドレスなどもあります。

#### IPv4/IPv6共存技術の使用例
- **デュアルスタック環境**: IPv4とIPv6の両方のプロトコルスタックを持つデバイスで、これらのアドレス形式を使用して両方のネットワークと通信できます。
- **トンネリング**: IPv4ネットワーク上でIPv6パケットをカプセル化して送信する際に、これらのアドレス形式が使用されることがあります。
- **NAT64**: IPv6のみのクライアントがIPv4のみのサーバーと通信する際に、これらのアドレス形式が変換プロセスで使用されます。

### IPパケット転送の実現方法

IPv4では、IPパケットの転送において、ARP（Address Resolution Protocol）やIGMP（Internet Group Management Protocol）といった**IPv4とは別のプロトコル**が重要な役割を担っています。

一方、IPv6ではこれらのプロトコルが「**近隣探索プロトコル**」に統合されています。この近隣探索プロトコルでは、従来のIPv4でエラー通知などに使用されていたICMP（Internet Control Message Protocol）を拡張した [**ICMPv6**](https://wa3.i-3-i.info/word15041.html)が利用されています。

その結果、**IPv6においてはICMPの重要性がIPv4よりもさらに増している**といえます。

### 1つのネットワークインターフェースのIPアドレス数

IPv4では、1つのネットワークインターフェースに設定するIPアドレスは**1つだけ**でした。

これに対し、IPv6では、1つのネットワークインターフェースに対して**複数**のIPアドレスを設定できます。
この複数のIPv6アドレスを同時に設定可能であるという特徴を使って、サイト全体で利用されているIPv6アドレスを変更する[サイトリナンバリング](https://www.youtube.com/watch?v=JeTPPpXp6Ss)という仕組みもあります。

### 自動的なアドレス設定方法

IPv4で自動的にアドレスの設定をする場合、**IPv4とは異なるプロトコルとして定義されているDHCP**を利用するしかありません。

一方で、IPv6で自動的にアドレスの設定をする場合、[**SLAAC**](https://e-words.jp/w/SLAAC.html)というアドレス自動設定のための仕組みが**IPv6プロトコルの一部として定義**されています。

### IPアドレスの運用方法

IPv4では、[ISP（個人や企業などに対してインターネットに接続するためのサービスを提供する事業者）](https://www.ntt.com/bizon/glossary/e-i/isp.html)から一般ユーザに**割り当てられるIPv4アドレスは1つ**で、それを家庭内やオフィス内で必要に応じてNATを使って運用するのが一般的です。

一方、IPv6では、ISPからアドレスが1つ割り当てられるのではなく、**ネットワークプレフィックスを割り当てられる**のが一般的です。

そのため、IPv6にはネットワークプレフィックスを割り当てるための仕組みとして、DHCPv6-PDというものがあります。

### ヘッダフォーマット

**IPv4はヘッダ全体の長さが可変**です。なぜなら、プロトコルの機能を拡張するために利用されるOptionフィールドが可変長だからです。

一方で、**IPv6のヘッダの長さは40バイトに固定**されています。
ここで、IPv6ヘッダにはOptionフィールドが存在しないため、[IPv6拡張ヘッダ](https://network-engineer.jp/archives/1136)という仕組みが用意されています。

### フラグメンテーション

IPv4では、**IPv4ヘッダに含まれるフィールドを利用**してIPパケットのフラグメンテーションを実現しています。
一方、IPv6ヘッダにはフラグメンテーションのための情報を格納するフィールドがありません。そのため、**IPv6拡張ヘッダを利用**してフラグメンテーションを行います。

また、IPv4では、IPパケットが経路の途中で利用されるデータリンク層のプロトコルの都合でフラグメンテーションが起きる場合がありましたが、IPv6ではそのようなことがありません。
そのため、IPv6ではPath MTU Discovery（最適なMTUサイズを動的に発見するためのプロセス）が重要になります。

### パケットサイズ

IPv4の基本仕様を規定する[RFC791](https://datatracker.ietf.org/doc/html/rfc791)では、“Allhosts must be prepared to accept datagrams of up to 576 octets”（「**最低でも576オクテットのデータグラムを受け取れるように準備していなければならない**」）と記述されています。
その上で、受信相手がそれ以上のサイズのデータグラムを受け取れるという保証がある場合、送信側が576オクテット以上のパケットを送信することを推奨しています。

一方、IPv6の基本仕様を規定する[RFC8200](https://datatracker.ietf.org/doc/html/rfc8200)では、“IPv6 requires that every link in the Internet have an MTU of 1280 octets or greater”（「**IPv6はインターネットにおけるすべてのリンクが1280オクテットもしくはそれ以上のMTUであることを要求する**」）と記述されています。
そのため、MTUが設定可能なリンクでは最低でも1280オクテットの値を設定することを必須としています。

IPv6はIPv4の576バイトよりも大きいパケットサイズを採用することで、**将来的なネットワーク技術の進化にも対応できるようになっている**のが特徴です。

### ブロードキャストからマルチキャストへ

IPv6では、**ブロードキャストが廃止**され、その機能の多くが**マルチキャスト**に置き換えられました。
これにより、**特定のノードにのみパケットを送信する**ため、ネットワークリソースを効率的に使用できるようになりました。

## まとめ

表にまとめてみます。

|                           | IPv4                                              | IPv6                                                         |
|---------------------------|---------------------------------------------------|--------------------------------------------------------------|
| IPアドレス長               | 32ビット                                         | 128ビット                                                    |
| テキスト表記               | ドット(.)区切りの十進表記                         | コロン(:)区切りの十六進表記                                  |
| 構成要素                   | ネットワーク部とホスト部                         | サブネットプレフィックスとインターフェース識別子              |
| アドレスのフォーマットの利用方法 | クラス分けにより判別                            | アドレスフォーマットからどの機能に使うアドレスか判別          |
| IPパケット転送の実現方法   | ARP, IGMPなど                                   | 近隣探索プロトコル                                           |
| エラー通知                 | ICMPを利用                                      | 拡張されたICMPv6を利用                                        |
| 1つのネットワークインターフェースのIPアドレス数 | 1つだけ                                      | 複数設定できる                                               |
| 自動的なアドレス設定方法   | DHCP                                            | SLAACなど                                                     |
| 一般的な運用方法             |  ISPからアドレスが1つ割り当てられる                           |　ネットワークプレフィックスを割り当てられる
| ヘッダフォーマット         | ヘッダ全体の長さが可変                           | 長さは40バイトに固定、IPv6拡張ヘッダという仕組みが用意       |
| フラグメンテーション       | IPv4ヘッダに含まれるフィールドを利用経路の途中でフラグメンテーションが起きる場合がある              | IPv6拡張ヘッダを利用、経路の途中でフラグメンテーションが起きない、Path MTU Discoveryが重要                                          |
| パケットサイズ             | 最低でも576オクテットのデータグラムを受け取れる準備が必要 | 最低でも1280オクテットの値を設定することを必須               |
| ブロードキャスト           | ブロードキャストあり                             | 廃止されマルチキャストへ                                      |

こうしてみると、全然違いますね！

## さいごに

ここまで記事を読んでくださり、ありがとうございました！

この記事ではIPv4とIPv6の違いについて紹介しましたが、より詳しく知りたい方は「[小川晃通 著, プロフェッショナルIPv6 第2版, ラムダノート](https://www.lambdanote.com/products/ipv6-2)」や[小川晃通氏のYouTube](https://www.youtube.com/@geekpage)などを参考にしてください！

また、[プロフェッショナルIPv6のPDF版は無料で利用可能](https://forest.watch.impress.co.jp/library/software/proipv6/)なので、興味を持った方はぜひ読んでみてください！

ネットワークは良いですよ！！！

**皆さんも素敵なハッピーIPv6ライフを！！！🌸**
