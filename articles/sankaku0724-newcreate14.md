---
title: "DockerでGo言語を導入しようとしたら詰まった話"
emoji: "🤮"
type: "tech"
topics:
  - "dockerdesktop"
  - "cloud"
  - "docker"
  - "container"
  - "go"
published: false
---

## はじめに

今回は、Dockerの初心者の私が軽い気持ちでGo言語を導入しようとして大苦戦した際の解決方法になります．

:::message
この記事は、Docker&Go言語初心者である私の解釈に基づいてまとめたものです。
もし誤解や間違いがあれば、ぜひコメントなどでご指摘していただけると助かります。
:::

### 私の動作環境

- Docker Desktop 4.21.1 (114176)
- Docker Engine 24.0.2
- Docker Compose v2.19.1
- MacOS Sonoma 14.4.1

## 経緯（というほどのものでもないですが）

Dockerの練習がてら，何か環境を試してみたいなぁ⋯
せや！Go言語って有名だけど使ったことないし試してみるか！

~~これが地獄の始まりになるなんて⋯~~


## Go言語をコンパイルしてみる
試しにGo言語をコンパイルしてみましょう．
Dockerコンテナを使えば、プログラミング言語の環境を手軽に試せます。コンテナを破棄してしまえば、元の状態にすぐに戻せますしね。
Docker Hubには、Go言語のコンテナがあります。これを使って、Go言語のプログラムをコンパイルしてみましょう。

1. ソースコードを用意する
Go言語のソースコードを用意します。私はカレントディレクトリに以下のようなソースコードを用意しました．

```go:hello.go
package main

import "fmt"

func main(){
	fmt.Printf("Hello World\n")
}
```

2. Go言語のコンテナを起動して実行する

Go言語のイメージは、「golang」という名前です。下記のサイトに使い方が記述されています。

https://hub.docker.com/_/golang

記載されている使い方の通りに次のコマンドを入力して実行してみます。

```
docker run --rm -v "$PWD":/usr/src/myapp -w /usr/src/myapp golang:1.22 go build -v
```

ここで指定したオプションは、次の通りです。

- --rm

実行が完了した時に、このコンテナを破棄するオプションです。

- -v "$PWD":/usr/src/myapp

カレントディレクトリを、コンテナ内の/usr/src/myappに割り当てる役割を持っています。

- -w /usr/src/myapp

「-w」オプションは、コンテナ内のプログラムを実行する時の作業ディレクトリを指定します。/usr/src/myappは、vオプションでマウントしたディレクトリであり，これはDockerホストのカレントディレクトリにマウントされているため、コンテナ内ではこのディレクトリに対してGo言語のビルドが実行されます。

![](/images/sankaku14/0.png)


ところが，コンテナを起動することができませんでした．エラーの内容を見ると，**go.modファイルが存在しない**と出ています．
[go.modについて説明している公式サイト](https://go.dev/doc/modules/gomod-ref)によると，どうやら，**go.modファイルはGo言語の依存関係を管理するために必要**であるようです．

調べてみると[Go言語の公式サイト](https://go.dev/doc/tutorial/create-module)に解決方法が記載されていました．

`go mod init`コマンドを使用することで、go.modファイルを作成できるようです。`go mod init`コマンドは，

```
go mod init プロジェクト名
```

といった書式で使用できます．

ではこれをコンテナの中で使用しましょう．コンテナの中をメンテナンスするためには「-it」オプションをつければ良いので，それを付けてシェルで操作できるようにして実行してみます．

```
docker run --rm -it -v "$(pwd)":/go/src/app -w /go/src/app golang /bin/bash
```

内部を操作できるようになったら，以下のコマンドを実行してgo.modファイルを作成しましょう．

```
go mod init myapp
```

また，今回はコンパイルの作業もコンテナ内で行う必要があるため，以下のコマンドを実行してコンパイルしましょう．

go build: Go言語のコンパイラで、Goのソースコードをバイナリ実行ファイルに変換します。
-o myapp: -oオプションは、出力ファイルの名前を指定します。ここではmyappという名前の実行可能ファイルを指定しています。
.: カレントディレクトリを指定します。この場合、カレントディレクトリ内にあるすべてのGoソースコードを対象としています。

```
go build -o myapp .
```

作業が終わった後には`exit`でシェルを終了させるのも忘れずに．





3. ファイルの生成

ビルドが完了すると、コンテナは終了します。そして、ビルド後のプログラムがmyappという名前で生成されます。lsコマンドで確認してみましょう。

memo

下記の結果を見るとわかりますが、myappはrootユーザーの権限で作られます。削除するには、sudo操作が必要です。



4. 実行する

「./myapp」と入力すると実行できます。実行すると、画面には「Hello World」と表示されます。



Hello World




![](/images/sankaku14/1.png)

![](/images/sankaku14/2.png)

![](/images/sankaku14/3.png)



https://stackoverflow.com/questions/28755916/go-how-does-go-run-file-go-work

https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies

https://pkg.go.dev/cmd/go#hdr-Compile_and_run_Go_program

```
docker run --rm -v "$PWD":/usr/src/myapp -w /usr/src/myapp golang:1.22 go run hello.go
```

![](/images/sankaku14/4.png)

［5］ コンテナの状態を確認しておく

最後に、コンテナの状態を確認しておきましょう。docker ps-aと入力しても、何も表示されないことを確認してください。これは、docker runするときに、「-Im」オプションを付けているので、コマンドの実行が終わったとき（go build-vが終わったとき）に、コンテナが破棄されるためです。

$ docker ps-a



4-5-2 コンテナがたくさん作られないように注意するここではGo言語を使う例を示しましたが、ほかにも、機械学習やTeXによる組版、PDF処理、画像変換など、さまざまな用途で、こうしたDockerコンテナが使われることがあります。オフィシャルなものは意外と少ないですが、Docker Hubを探せば、個人や団体が作っている、とても便利なコンテナがたくさん見つかります。


出来合いのコンテナを使えば、環境構築が格段と楽になります。「使いたいツールがあるけれどもインストールはちょっと」と尻込みしているツールがもしあるなら、Docker Hubで探してコンテナで利用してみてください。

こうした「1回だけ使うコンテナ」を使うとき、1つ注意点があります。それは、コンテナが増えてし

まうことです。Go言語の例では、docker runする際に、-mmオプションを指定したので、終了と同時にコンテナが破棄されました。しかし-Inオプションを指定しない場合は、それらのコンテナが残ります。その場合、docker ps-aで見ると、多数のExitedのコンテナを見ることになるでしょう。

こうならないためにも、コンテナは終了しても残ったままになることを理解し、オプションを指定する、もしくは、都度、docker rmで終了するなどして、不要になったコンテナが残らないように注意しましょう。

## さいごに

ここまで記事を読んでくださり、ありがとうございました！

今回は、私がDockerを利用していく中で重要だと感じたDockerコンテナの基本操作方法についてまとめてみました。

まだまだ経験が浅く使い慣れていないですが、Dockerをより理解するために突き進んでいきたいと思います！

**皆さんも素敵なハッピーDocker&Goライフを！！！🌸**
